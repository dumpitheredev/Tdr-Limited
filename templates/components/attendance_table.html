<style>
    .attendance-header {
        color: #191970;
        background-color: #d3d3d3;
        height: 82px;
        text-align: center;
        vertical-align: middle;
        padding: 15px;
    }

    .student-header {
        color: #191970;
        background-color: #d3d3d3;
        height: 82px;
        display: flex;
        align-items: center;
        padding-left: 15px;
    }

    .student-cell {
        background-color: #f8f9fa;
        height: 82px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .student-name {
        font-weight: 500;
        margin-bottom: 4px;
    }

    .student-info {
        color: #6c757d;
        font-size: 0.875rem;
    }

    .attendance-cell {
        height: 82px;
        text-align: center;
        vertical-align: middle !important;
        padding: 15px !important;
    }

    .attendance-content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
    }

    .attendance-badge {
        margin-bottom: 4px;
    }

    .attendance-time {
        color: #6c757d;
        font-size: 0.875rem;
    }

    /* Ensure tables have consistent widths */
    .student-table, .attendance-table {
        table-layout: fixed;
    }

    /* Ensure cells maintain height */
    .student-table td, .attendance-table td {
        height: 82px;
    }

    /* Responsive styles */
    .attendance-wrapper {
        display: flex;
        width: 100%;
        overflow-x: auto;
    }

    .student-column {
        min-width: 200px;
        flex-shrink: 0;
        background-color: #f8f9fa;
        border-right: 2px solid #dee2e6;
        position: sticky;
        left: 0;
        z-index: 10;
    }

    .calendar-column {
        flex-grow: 1;
        min-width: min-content;
    }

    .attendance-header {
        min-width: 100px; /* Minimum width for date columns */
        white-space: nowrap;
    }

    .attendance-cell {
        min-width: 100px;
        white-space: nowrap;
    }

    /* Custom scrollbar for better UX */
    .attendance-wrapper::-webkit-scrollbar {
        height: 8px;
    }

    .attendance-wrapper::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .attendance-wrapper::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .attendance-wrapper::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Shadow indicator for scroll */
    .has-more-content::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 30px;
        background: linear-gradient(to right, transparent, rgba(0,0,0,0.1));
        pointer-events: none;
    }

    .date-range-filter {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        align-items: center;
    }

    .date-input-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex: 1;
        min-width: 200px;
    }

    .date-input-wrapper {
        position: relative;
        flex: 1;
    }

    .date-input {
        width: 100%;
        padding: 0.375rem 2.25rem 0.375rem 0.75rem;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
    }

    .calendar-icon {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
        color: #6c757d;
    }

    .filter-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }


    /* Responsive adjustments */
    @media (max-width: 768px) {
        .date-range-filter {
            flex-direction: column;
            align-items: stretch;
        }

        .date-input-group {
            width: 100%;
        }

        .filter-buttons {
            width: 100%;
            justify-content: flex-end;
        }

        .filter-buttons button {
            flex: 1;
        }
    }

    @media (max-width: 576px) {
        .date-input-group {
            flex-direction: column;
            align-items: stretch;
        }

        .date-input-group label {
            margin-bottom: 0.25rem;
        }
    }
</style>

<!-- Include Flatpickr CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<div class="date-range-filter">
    <div class="date-input-group">
        <label for="startDate">From:</label>
        <div class="date-input-wrapper">
            <input 
                type="text" 
                id="startDate" 
                class="date-input flatpickr-input"
                placeholder="Select start date"
                aria-label="Start date"
                readonly="readonly"
            >
            <i class="bi bi-calendar3 calendar-icon"></i>
        </div>
    </div>
    <div class="date-input-group">
        <label for="endDate">To:</label>
        <div class="date-input-wrapper">
            <input 
                type="text" 
                id="endDate" 
                class="date-input flatpickr-input"
                placeholder="Select end date"
                aria-label="End date"
                readonly="readonly"
            >
            <i class="bi bi-calendar3 calendar-icon"></i>
        </div>
    </div>
    <div class="filter-buttons">
        <button 
            type="button" 
            class="btn btn-primary apply-filter"
            style="background-color: #191970; border-color: #191970;"
            onclick="attendanceTable.filterAttendance()"
        >
            Apply Filter
        </button>
        <button 
            type="button" 
            class="btn btn-outline-secondary"
            onclick="attendanceTable.resetFilter()"
        >
            Reset
        </button>
    </div>
</div>

<!-- Include Bootstrap Icons if not already included -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

<div class="attendance-wrapper">
    <!-- Student Column (Fixed) -->
    <div class="student-column">
        <table class="table table-bordered mb-0">
            <thead>
                <tr>
                    <th class="student-header">Student Data</th>
                </tr>
            </thead>
            <tbody id="studentNameColumn">
                <!-- Will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <!-- Calendar View (Scrollable) -->
    <div class="calendar-column">
        <table class="table table-bordered mb-0">
            <thead>
                <tr>
                    {% if dates %}
                        {% for date in dates %}
                        <th class="attendance-header">
                            {{ date.day }}<br>
                            <small>{{ date.date }}</small>
                        </th>
                        {% endfor %}
                    {% else %}
                        <th class="attendance-header">Mon<br><small>21</small></th>
                        <th class="attendance-header">Tue<br><small>22</small></th>
                        <th class="attendance-header">Wed<br><small>23</small></th>
                        <th class="attendance-header">Thu<br><small>24</small></th>
                        <th class="attendance-header">Fri<br><small>25</small></th>
                        <th class="attendance-header">Mon<br><small>28</small></th>
                        <th class="attendance-header">Tue<br><small>29</small></th>
                        <th class="attendance-header">Wed<br><small>30</small></th>
                        <th class="attendance-header">Thu<br><small>31</small></th>
                        <th class="attendance-header">Fri<br><small>01</small></th>
                    {% endif %}
                </tr>

            </thead>
            <tbody id="attendanceTableBody">
                <!-- Will be populated dynamically -->
            </tbody>
        </table>
    </div>
</div>

<!-- Add this after the attendance-wrapper div -->
{% if not is_student_view %}
<div class="d-flex justify-content-between align-items-center mt-3">
    <div class="d-flex align-items-center">
        <span class="me-2">Show rows per page:</span>
        <select class="form-select form-select-sm" style="width: 60px;" id="modalRowsPerPage">
            <option value="5"selected>5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
        </select>
    </div>
    <div class="d-flex align-items-center">
        <button class="btn btn-sm btn-outline-secondary me-2" id="modalPrevPage">
            <i class="bi bi-chevron-left"></i>
        </button>
        <span id="modalPageInfo">1-10 of 20</span>
        <button class="btn btn-sm btn-outline-secondary ms-2" id="modalNextPage">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize start date picker
    const startDatePicker = flatpickr("#startDate", {
        dateFormat: "d/m/Y",
        allowInput: true,
        maxDate: 'today',
        onChange: function(selectedDates, dateStr) {
            // Update end date minimum when start date changes
            endDatePicker.set('minDate', dateStr);
        }
    });

    // Initialize end date picker
    const endDatePicker = flatpickr("#endDate", {
        dateFormat: "d/m/Y",
        allowInput: true,
        maxDate: 'today',
        onChange: function(selectedDates, dateStr) {
            // Update start date maximum when end date changes
            startDatePicker.set('maxDate', dateStr);
        }
    });

    // Set initial dates (last 7 days)
    const today = new Date();
    const lastWeek = new Date(today);
    lastWeek.setDate(today.getDate() - 6); // Show last 7 days including today

    startDatePicker.setDate(lastWeek);
    endDatePicker.setDate(today);

    // Make calendar icons clickable
    document.querySelectorAll('.calendar-icon').forEach(icon => {
        icon.style.pointerEvents = 'auto';
        icon.style.cursor = 'pointer';
        icon.addEventListener('click', (e) => {
            const input = e.target.closest('.date-input-wrapper').querySelector('input');
            input.click();
        });
    });
});
</script> 