<style>
    .card {
        border: 1px solid rgba(0, 0, 0, .125);
        margin-bottom: 1rem;
    }

    .card-header {
        padding: 0.75rem 1.25rem;
        border-bottom: 1px solid rgba(0, 0, 0, .125);
    }

    .card-body {
        padding: 1.25rem;
    }

    .lecture-header {
        color: #191970;
        background-color: #d3d3d3;
        min-width: 200px;
    }

    .attendance-header {
        min-width: 150px;
    }

    .lecture-cell {
        min-width: 200px;
        background-color: #f8f9fa;
    }

    .attendance-cell {
        min-width: 150px;
    }

    .attendance-badge {
        display: block;
        padding: 6px 12px;
        border-radius: 20px;
        margin-bottom: 4px;
        font-size: 14px;
        font-weight: 500;
    }

    .badge-present {
        background-color: #28a745;
        color: white;
    }

    .badge-absent {
        background-color: #dc3545;
        color: white;
    }

    .badge-late {
        background-color: #ffc107;
        color: black;
    }

    .attendance-cell {
        text-align: center;
        padding: 15px !important;
        vertical-align: middle !important;
    }

    /* Ensure attendance percentage is always visible */
    #attendancePercentage {
        visibility: visible !important;
        display: block !important;
        opacity: 1 !important;
        font-size: 2rem !important;
        font-weight: 600 !important;
        min-height: 2.5rem !important;
    }

    /* Attendance table scrolling styles */
    .attendance-scrollable-container {
        width: 100%;
        overflow-x: auto;
        position: relative;
        max-height: 400px;
        margin-bottom: 1rem;
    }

    .attendance-scrollable-container table {
        table-layout: fixed;
        margin-bottom: 0;
    }

    .attendance-scrollable-container th:first-child,
    .attendance-scrollable-container td:first-child {
        position: sticky;
        left: 0;
        z-index: 1;
    }

    .attendance-scrollable-container th:first-child {
        background-color: #f8f9fa;
    }

    .attendance-scrollable-container td:first-child {
        background-color: #fff;
    }

    /* Add shadow to indicate scrolling */
    .attendance-scrollable-container::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 5px;
        background: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.1));
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .attendance-scrollable-container:hover::after {
        opacity: 1;
    }
</style>

<!-- Include Flatpickr CSS and JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

{% macro view_student_modal() %}
<!-- View Student Modal -->
<div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewStudentModalLabel">Student Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Student Profile Header -->
                    <div class="col-12 mb-4">
                        <div class="d-flex align-items-center gap-4">
                            <img id="studentImage" src="{{ url_for('static', filename='images/profile.png') }}"
                                alt="Student Photo" class="rounded-circle"
                                style="width: 120px; height: 120px; object-fit: cover;">
                            <div>
                                <div class="d-flex align-items-center gap-3 mb-2">
                                    <h2 id="studentName" class="mb-0 fw-semibold" style="color: #191970;"></h2>
                                    <span id="studentStatus" class="badge"></span>
                                </div>
                                <p class="mb-1">Student ID: <span id="studentId" class="fw-bold" style="color: #191970;"></span></p>
                                <p class="mb-1">Student Company: <span id="studentCompany"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Classes Enrolled -->
                    <div class="col-12">
                        <div class="card border">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Classes Enrolled</h6>
                            </div>
                            <div class="card-body">
                                <div id="enrolledClasses"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Attendance Section -->
                    <div class="col-12 mt-4">
                        <div class="card border">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Attendance Record</h6>
                            </div>
                            <div class="card-body">
                                <!-- Date filter form -->
                                <div class="date-filter-form my-3 d-flex flex-wrap">
                                    <div class="d-flex align-items-center me-2 mb-2">
                                        <label for="modalStartDate" class="form-label me-2 mb-0">From:</label>
                                        <input type="text" id="modalStartDate"
                                            class="form-control form-control-sm date-input" placeholder="Select date">
                                    </div>
                                    <div class="d-flex align-items-center me-2 mb-2">
                                        <label for="modalEndDate" class="form-label me-2 mb-0">To:</label>
                                        <input type="text" id="modalEndDate"
                                            class="form-control form-control-sm date-input" placeholder="Select date">
                                    </div>
                                    <button type="button" id="modalApplyDateFilter" class="btn btn-sm me-2 mb-2"
                                        onclick="applyDateFilter('modal')"
                                        style="background-color: #191970; color: white;">Apply Filter</button>
                                    <button type="button" id="modalResetDateFilter"
                                        class="btn btn-sm btn-outline-secondary mb-2"
                                        onclick="resetDateFilter('modal')">Reset</button>
                                </div>

                                <!-- Attendance Table Container with horizontal scrolling -->
                                <div id="attendance-records-container" class="attendance-scrollable-container">
                                    <table class="table table-bordered">
                                        <thead id="attendance-headers">
                                            <!-- Dynamic headers will be added here -->
                                        </thead>
                                        <tbody id="attendance-data">
                                            <!-- Dynamic attendance data will be added here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row mt-4">
                        <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
                            <div class="card">
                                <div class="card-header" style="background-color: #C0C0C0;">
                                    <h6 class="mb-0" style="color: #191970;">Total Present</h6>
                                </div>
                                <div class="card-body">
                                    <h2 class="mb-0" id="totalPresent">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
                            <div class="card">
                                <div class="card-header" style="background-color: #C0C0C0;">
                                    <h6 class="mb-0" style="color: #191970;">Total Late</h6>
                                </div>
                                <div class="card-body">
                                    <h2 class="mb-0" id="totalLate">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
                            <div class="card">
                                <div class="card-header" style="background-color: #C0C0C0;">
                                    <h6 class="mb-0" style="color: #191970;">Total Absence</h6>
                                </div>
                                <div class="card-body">
                                    <h2 class="mb-0" id="totalAbsence">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-sm-12 mb-3">
                            <div class="card">
                                <div class="card-header" style="background-color: #C0C0C0;">
                                    <h6 class="mb-0" style="color: #191970;">Attendance %</h6>
                                </div>
                                <div class="card-body">
                                    <h2 class="mb-0" id="attendancePercentage"
                                        style="visibility: visible; display: block;">0%</h2>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Note about attendance calculation -->
                    <div class="col-12 mb-3">
                        <div class="small text-muted text-center" id="attendance-calculation-note">
                            <i class="bi bi-info-circle me-1"></i>Note: Late attendance is counted as present for
                            percentage calculation
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <!-- Add other actions if needed -->
            </div>
        </div>
    </div>
</div>
{% endmacro %}